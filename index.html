<html>
<head>

	<title>Physics Engine</title>


	<!--

	TODO list

		* CD
			- Spatial data structure - BS
			- Architecture (separate physique components...compile into 1 file)
			- Broadphase
				- islands
				- data structure for world
				- improve SAP add/update body (linked list; cache pointers)
				- temporal coherence for SAP axis list
			- SAT
				- IMPLEMENT: for each object find all axis (normal of each face on polygon), merge axis between object pairs; for each axis, project each objects' vertices onto axis to find min/max line on axis; if ALL axis have collision then there is a collision, and the normal is the axis)
				- NOTE: circles need a separate case for testing
				- cache object axes (rotate only when necessary)
				- cache object world vertices (only rotate when necessary)
				- boxes should only have 3 distinct axes for faces (skip the scalar multiples on opposite side)
				- look into SAT colliding on edges issue
				- ERROR:
					* check face/normal (debug lines) - is the normal updated interally already? no need to automatically apply quaternion? are normals facing the right direction?
					* 
			- GJK
				- pick a more intuitive initial direction
				- improve support function
				- look into GJK numerical stability issues
					- Erin Catto GDC 2010: GJK lecture pg. ~113
				- look into GJK penetration & margins: http://hacktank.net/blog/?p=129
				- look into GJK early-out: why do people claim that GJK can finish without being a tetrahedron? (pg. 159 of Collision Detection / 3d Environments book)
				- continuous collision detection (extend support function from initial position of body to end position of body)
			- EPA
				- DEBUG: draw contact points (turn colliding meshes transparent); draw contact normals; draw penetration depth (line from start to end to show precise contact area)
				- Look into Goblin Physics silhouette algorithm (efficiency)
				- BUG: creating new face sometimes has reverse normal
				- BUG: sometimes hits infinite loop (redundant vertices added from support point)
			- report contact manifold
		* CR
			- restitution?
			- baumgarte?
			- pre-sequential solvers? split penetration/velocity?
			- friction
			- slop
			- warm start?

			- BUG: lots of stacked boxes colliding results in delayed penetration...this may be due to deepest penetration at one point, and may need to rotate box to find multiple contact points
			- BUG: pick up + drop box: at low height we can see restitution (bounce), but at slightly higher height we can see the box falls slightly under the ground and has to raise back up (seems like only certain heights and only sometimes)
			- BUG: 2 objects colliding in a weird way sometimes disappear (rare bug - probably an explosive impulse? or NaN?)

		* UI 
			- edit clock
			- keep track of snapshots of world; then step backwards in time (debug)
			- improve raycasting / moving object
		* Examples
			- Dominos
			- Wall of cubes, and shooting out a massive sphere at it (like in the proposal pic)
			- Hinge joint: bridge; chain w/ sphere (wrecking ball)
			- Point joint: machine w/ claw to turn, go down, grab cube, raise up, turn and drop cube



	* Stable box stacking
	* Speed improvements
	* Boxes slowly raising out of ground
	

	-->




	<!-- disable evil cache -->
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />

	<!-- styles -->
	<!-- <link href="styles/libs/bootstrap.min.css" rel="stylesheet"> -->
	<link rel="stylesheet" href="styles/main.css">


	<!-- scripts -->
	<script src="scripts/libs/jquery-2.1.3.min.js"></script>
	<script src="scripts/libs/three.js"></script>
	<!-- <script src="scripts/libs/bootstrap.min.js"></script> -->
	<script src="scripts/libs/underscore-min.js"></script>
	<script src="scripts/libs/modernizr.min.js"></script>
	<script src="scripts/libs/require.js"></script>
	<!-- <script src="scripts/GoblinPhysics/build/goblin.js"></script> -->
	<script>
		requirejs.config({
			"baseUrl": "scripts",
		});

		require(['keys'], function(Keys){

			window['Keys'] = Keys;

			var readyToStartup = function(){

				$(document).ready(function(){

					// Startup
					require(['main']);
				});

			};

			// Make sure that we have ES6 Promises before starting webapp
			Modernizr.load([
				{
					test: Promise,
					nope: ['scripts/libs/es6-promise-2.0.1.min.js'],
					complete: readyToStartup
				}
			]);
		
		});

		var scene    = null,
			renderer = null,
			physique = null;
	</script>

</head>
<body>

	<div id="options">
		<div class="section">
			<span class="section-title">Physics Controls</span>
			<div class="details">
				<input id="objectsInput" list="objects" name="object">
				<datalist id="objects">
				</datalist>
				<span class=option-text">Meshes</span>
				<br/>

				<input id="rotX" type="range" value="0" min="-314.1" max="314.1" />
				<span class="option-text">Rotate X</span>

				<br/>

				<input id="rotY" type="range" value="0" min="-314.1" max="314.1" />
				<span class="option-text">Rotate Y</span>

				<br/>

				<input id="rotZ" type="range" value="0" min="-314.1" max="314.1" />
				<span class="option-text">Rotate Z</span>

				<br/>
				<br/>

				<div id="controls">
					<a href="#" id="stopPhysics"  class="button">STOP</a>
					<a href="#" id="stepPhysics"  class="button">STEP</a>
					<a href="#" id="startPhysics" class="button">START</a>

					<br/>
					<!-- <a href="#" id="resetPhysics" class="button">RESET</a> -->
				</div>
			</div>
		</div>
		<div class="section">
			<span class="section-title">World Properties</span>
			<div class="details">
				<label for="scaleTime" class="option-text">Scale Time: </label>
				<input id="scaleTime" type="number" class="number" max="0.002" min="0.0001" step="0.0001" value="0.0001" />
				<br/>

				<label for="baumgarte" class="option-text">Baumgarte: </label>
				<input id="baumgarte" type="number" class="number" max="1.0" min="0.0" step="0.1" value="0.1" />
				<br/>

				<label for="damping" class="option-text">Velocity Dampening: </label>
				<input id="damping" type="number" class="number" max="1.0" min="0.0" step="0.1" value="1.0" />
				<br/>

				<label for="warmth" class="option-text">Warmstart Multiplier: </label>
				<input id="warmth" type="number" class="number" max="1.0" min="0.0" step="0.1" value="1.0" />
				<br/>

				<label for="restitution" class="option-text">Restitution: </label>
				<input id="restitution" type="number" class="number" max="1.0" min="0.0" step="0.1" value="0.0" />
				<br/>

				<label for="friction" class="option-text">Friction: </label>
				<input id="friction" type="number" class="number" max="1.0" min="0.0" step="0.1" value="0.2" />
				<br/>

				<!-- <label for="slop" class="option-text">Slop: </label> -->
				<!-- <input id="slop" type="number" class="number" max="0.0" min="-0.5" step="0.001" value="0.0" /> -->
				<!-- <br/> -->
			</div>
		</div>
	</div>

</body>
</html>
